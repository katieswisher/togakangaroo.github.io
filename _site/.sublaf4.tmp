<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta content="en-au" http-equiv="Content-Language" />
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Blog Feed" />
		<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Blog Feed" />

		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
		<title>On this and new</title>
		<link rel="stylesheet" type="text/css" href="/css/style.css" />
		<link rel="shortcut icon" href="/img/favicon.ico" />
	</head>
	<body>
		<div id="container">
			<div id="side">
				<a href="/" id="home" title="home" alt="home"><img src="/img/logo.png" alt="Site Name" /></a>
				<div id="hometext"><a href="/" >George Mauer's Blog</a></div>
				<div class="section">
					<ul>
						<li><a href="/about.html">about</a></li>
						<li><a href="/rss.xml"><img src="/img/25.png" /> feed</a></li>
					</ul>
				</div>
			</div>
			<div id="content">
				<div class="entry-container">
	<div class='entry'>
		<h1> On this and new </h1>
		<span class="postdate">
			
		</span>
		This is the pattern that a lot things recommend
 
<pre><code class="javascript">
    function Person(firstName, lastName) {
      this.firstName = firstName;
      this.lastName = lastName;
      this.name = function() { return this.firstName + " " + this.lastName;}
    	this.printName = function() { console.log("my name is", this.name())}
    }
    var george = new Person("George", "Mauer");
</code></pre>
 
What do you think that `new` does? It's not what you think. This is what `new` actually does
 
<pre><code class="javascript">
    var fn = new Function();
    fn.__proto__ = Person; //chrome only - each browser has a different syntax for this step
    var res = Person.call(fn, firstName, lastName);
    return (res === undefined) ? fn : res;
</code></pre>
 
Huh? But that's insane.....exactly.
 
What about `this`? How can that be confusing.
 
The problem is that despite what you think `this` doesn't reference scope. It is really just a parameter like any other. This becomes a lot more clear if you realize that
 
<pre><code class="javascript">
    myFunc(1,2,3); 

 
is really just a facade for how javascript **really** invokes methods
 
<pre><code class="javascript">
    myFunc.call(whateverThisIs, 1, 2, 3);
</code></pre>
    
So all that `this` is, is just the first parameter passed into `.call()`. That's it - no magic, no language-support, it's just a parameter.

Worse, if you use the simpler syntax, javascript will pick what the value of that parameter should be at runtime. The rules aren't terribly complex but they're often not what you want. As an example:
 
<pre><code class="javascript">
    george.printName(); //equivalent to george.prototype.printName.call(george)
    var printName = george.printName();
    printName();        //equivalent to george.prototype.printName.call(window);
</code></pre>
    
And it gets wierder if you consider strict mode.
 
A lot of libraries **also** take guesses at what `this` should be.
 
<pre><code class="javascript">
    $('button').click(george.printName); //this won't work because "this" is the button element and doesn't have name()
</code></pre>
 
`this` is therefore a parameter like any other and by using it you're trusting people to always pass in the correct value. And other people know less about `this` than you do!
 
so you **could** always use the `fn.call()` syntax. Or you could
 
# Not Use this or new
 
The same code but without these keywords:
 
<pre><code class="javascript">
    function createPerson(firstName, lastName) {
    	var _p = {
    		 firstName: firstName
    		,lastName:  lastName
    		,name:      function() { return _p.firstName + " " + _p.lastName}
    		,printName: function() { console.log("My name is", _p.name())}
    	};
    	return _p;  // I like an underscore prefix to indicate "this is what I'm buiding here"
    }
    
    var betterGeorge = createPerson("George", "Mauer");
</code></pre>
    
And bam! No more wierd implicit parameters, callbacks and everything else works great forever!
 
# To Be Fair
 
Sometimes you can't get away from it. If you're in a jQuery callback for example you might have to use `this` because that's how the framework works. But please, **please** don't write your own code to use it.
 
Also, there ARE a few benefits to the `new`/`this` thing.
 
* In some cases referencing `this` is slightly faster than referencing a variable in a parent scope. This difference is very slight and basically matters only if you're writting the next underscore or jQuery. Your project doesn't need it. Seriously Mario, your bottleneck is in another castle.
* If you need to [support a browser without `Object.create`](http://caniuse.com/#search=object.create) there is no other way to wire up prototype inheritence cross-browser. This is another thing that unless you're building an extensible framework you probably don't need. If you need to share properties or methods every library has a version of the [extend helper](http://api.jquery.com/jQuery.extend/) that will work for this.
* Finally, there's the fact that when logged to a console, things with a prototype look **slightly** nicer and are labeled as their prototype rather than as "Object". This is valid but a tiny, tiny issue.
 
As a whole these benefits certainly don't excuse introducing two whole new concepts into your code, especially concepts that are as confusing and poorly understood as `new` and `this`.

I think it is probably only fair to amend that I'm usually opposed to javascript class systems in general. They require the use of `new` (though not necessarily of `this` - I'll write up how later)
and between function composition and the extend pattern are generally not necessary for either organizing or building performant code in 90% of cases.
	</div>
</div>
<div id="page-navigation"> 
	<div class="left">  </div> 
	<div class="right">  </div> 
	<div class="clear">&nbsp;</div>
</div> 

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'togakangaroo'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

			</div>

		</div>
	</body>
</html>